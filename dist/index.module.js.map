{"version":3,"file":"index.module.js","sources":["../src/index.js"],"sourcesContent":["export default class InsertText {\n  constructor(element) {\n    if (typeof element == 'string') {\n      this.element = document.querySelector(element);\n    } else {\n      this.element = element;\n    }\n\n    let tag = this.element.tagName.toLowerCase();\n    if (tag == 'input' || tag == 'textarea') {\n      this.target = new InputTag(this.element);\n    } else {\n      this.target = new EditableTag(this.element);\n    }\n  }\n\n  run(text, pos) {\n    this.element.focus();\n    this.target.insert(text, pos);\n    this.element.focus();\n  }\n\n  static run(element, text, pos = 'caret') {\n    new InsertText(element).run(text, pos);\n  }\n}\n\nclass InputTag {\n  constructor(element) {\n    this.element = element;\n  }\n\n  insert(text, pos) {\n    switch (pos) {\n    case 'caret':\n      this.insertAtCaret(text);\n      break;\n    case 'first':\n      this.insertAt(text, 0);\n      break;\n    case 'last':\n      this.insertAt(text, this.element.value.length);\n      break;\n    default:\n      this.insertAt(text, pos);\n      break;\n    } \n  }\n\n  insertAtCaret(text) {\n    let start = this.element.selectionStart;\n    let end = this.element.selectionEnd;\n    this.insertAt(text, start, end);\n  }\n\n  insertAt(text, start, end = null) {\n    end = end || start;\n\n    let content = this.element.value;\n    this.element.value = `${content.substring(0, start)}${text}${content.substring(end)}`;\n\n    let pos = start + text.length\n    this.element.setSelectionRange(pos, pos);\n  }\n}\n\nclass EditableTag {\n  constructor(element) {\n    this.element = element;\n  }\n\n  insert(text, pos) {\n    switch (pos) {\n    case 'caret':\n      this.insertAtCaret(text);\n      break;\n    case 'first':\n      this.insertAtFirst(text);\n      break;\n    case 'last':\n      this.insertAtLast(text);\n      break;\n    default:\n      this.insertAt(text, pos.selector, pos.position);\n      break;\n    } \n  }\n\n  insertAtCaret(text) {\n    let newNode = this.createNode(text);\n    let selection = window.getSelection();\n    \n    let range;\n    if (selection.rangeCount > 0) {\n      range = selection.getRangeAt(0);\n    } else {\n      range = document.createRange();\n      range.setStart(this.element, 0);\n    }\n    range.deleteContents(); \n    range.insertNode(newNode);\n    range.setStartAfter(newNode);\n\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }\n\n  insertAtFirst(text) {\n    let newNode = this.createNode(text);\n    this.element.prepend(newNode);\n    this.adjustSelection(newNode);\n  }\n\n  insertAtLast(text) {\n    let newNode = this.createNode(text);\n    this.element.append(newNode);\n    this.adjustSelection(newNode, false);\n  }\n\n  insertAt(text, selector, pos) {\n    this.element.querySelectorAll(selector).forEach(elem => {\n      let target = Array.from(elem.childNodes).find(elem => elem.nodeType == 3);\n      let newNode = this.createNode(text);\n      let range = document.createRange();\n      range.setStart(target, pos);\n      range.insertNode(newNode);\n    });\n  }\n\n  createNode(text) {\n    let div = document.createElement('div');\n    div.innerHTML = text;\n    return div.firstChild; \n  }\n\n  adjustSelection(node, after = true) {\n    let selection = window.getSelection();\n    let range = document.createRange();\n    if (after) {\n      range.setStartAfter(node);\n    } else {\n      range.setStartBefore(node);\n    }\n    range.collapse(true);\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }\n}\n"],"names":["InsertText","constructor","element","this","document","querySelector","tag","tagName","toLowerCase","target","InputTag","EditableTag","run","text","pos","focus","insert","insertAtCaret","insertAt","value","length","selectionStart","selectionEnd","start","end","content","substring","setSelectionRange","insertAtFirst","insertAtLast","selector","position","range","newNode","createNode","selection","window","getSelection","rangeCount","getRangeAt","createRange","setStart","deleteContents","insertNode","setStartAfter","removeAllRanges","addRange","prepend","adjustSelection","append","querySelectorAll","forEach","elem","Array","from","childNodes","find","nodeType","div","createElement","innerHTML","firstChild","node","after","setStartBefore","collapse"],"mappings":"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"}